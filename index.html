<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>푸꾸옥 추천 추가 상품</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-spin-custom { animation: spin 1s linear infinite; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>

<body class="bg-gray-50 font-sans text-gray-800 relative min-h-screen">

    <div id="app"></div>

    <!-- Firebase 모듈 -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, deleteDoc, doc, updateDoc, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ==========================================
        // 1. Firebase 설정
        // ==========================================
        
        const firebaseConfig = {
            apiKey: "AIzaSyBZvfs5PFT4BvbYnRd4ZkjQkmiVTy1Ov0A",
            authDomain: "withan-1120.firebaseapp.com",
            projectId: "withan-1120",
            storageBucket: "withan-1120.firebasestorage.app",
            messagingSenderId: "638498968442",
            appId: "1:638498968442:web:aaaf12d2385737254cfcc3",
            measurementId: "G-TBD9W8B634"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const COLLECTION_NAME = 'travel_products'; 

        // ==========================================
        // 2. 초기 데이터 및 상태 관리
        // ==========================================

        const LOGO_IMAGE_URL = "https://cdn.monkeytravel.com/userCompany/1058603/logo/1067e5528b654db1c03737ce896c459c.png";
        
        // 비밀번호 "1233"을 Base64로 인코딩한 값
        const ADMIN_PASSWORD_ENCODED = "MTIzMw=="; 

        const INITIAL_SAMPLE_DATA = [
            {
                productName: "푸꾸옥 프라이빗 렌트카 투어 (기사포함)",
                category: "우리만 (Private)",
                heroImage: "https://images.unsplash.com/photo-1586943101559-4cdcf86a6f87?auto=format&fit=crop&q=80&w=1000",
                operatingHours: "09:00 - 21:00 (자유 일정)",
                description: "우리끼리만 편안하게! 원하는 일정대로 자유롭게 이동하는 프라이빗 렌트카 서비스입니다. \n베테랑 현지 기사님이 안전하게 모십니다. (유류비, 기사님 식대 포함)",
                pricingOptions: [
                    { id: 'opt1', name: '승용차 (4인승)', price: 60000, unit: '1대', desc: '최대 성인 3명 + 짐 2개' },
                    { id: 'opt2', name: 'SUV (7인승)', price: 75000, unit: '1대', desc: '최대 성인 5명 + 짐 3개' },
                    { id: 'opt3', name: '승합차 (16인승)', price: 110000, unit: '1대', desc: '단체/가족 여행 추천' },
                ],
                policies: {
                    cancellation: "이용일 2일 전까지 무료 취소 가능",
                    refundInfo: "차량 배차 확정 후 당일 취소 시 100% 수수료가 발생합니다.",
                    usageMethod: "상담을 통해 일정 확정 후, 카카오톡으로 기사님 정보를 보내드립니다.",
                },
                details: { notes: ["기사님은 간단한 영어 소통만 가능합니다."] },
                faq: [{ q: "기사님이 한국어를 하시나요?", a: "아니요, 현지 기사님이지만 번역기를 통해 소통에 문제 없습니다." }]
            },
            {
                productName: "빈펄 사파리 & 빈원더스 콤보권",
                category: "금까기 (Ticket)",
                heroImage: "https://images.unsplash.com/photo-1575550959106-5a7defe28b56?auto=format&fit=crop&q=80&w=1000",
                operatingHours: "09:00 - 19:30",
                description: "아시아 최대 야생 사파리와 테마파크를 한 번에! \n하루 종일 즐기는 환상의 나라로 초대합니다. QR 코드로 바로 입장하세요.",
                pricingOptions: [
                    { id: 'tkt1', name: '성인 콤보권', price: 85000, unit: '1인', desc: '만 12세 이상' },
                    { id: 'tkt2', name: '아동 콤보권', price: 62000, unit: '1인', desc: '만 4세~11세' },
                ],
                policies: {
                    cancellation: "QR 발권 전 무료 취소",
                    refundInfo: "사용 처리된 QR 코드는 환불 불가합니다.",
                    usageMethod: "이메일로 발송된 E-티켓을 입구에서 제시하세요.",
                },
                faq: [{ q: "셔틀버스는 무료인가요?", a: "네, 무료 셔틀을 운행합니다." }]
            }
        ];

        const state = {
            currentUser: null,
            products: [],
            loading: true,
            isAdmin: false,
            showAuthModal: false,
            passwordInput: "",
            loginError: false,
            selectedProductId: null,
            viewData: null,
            activeTab: 'info',
            deleteTargetId: null,
            isNewProduct: false,
            toast: { show: false, message: '', type: 'success' }
        };

        const formatCurrency = (amount) => new Intl.NumberFormat('ko-KR').format(amount);

        function checkPassword(input) {
            if (!input) return false;
            return btoa(input.trim()) === ADMIN_PASSWORD_ENCODED;
        }

        function showToast(message, type = 'success') {
            state.toast = { show: true, message, type };
            render();
            setTimeout(() => { state.toast.show = false; render(); }, 4000);
        }

        function setState(callback) { callback(state); render(); }

        // ==========================================
        // 3. Firebase Logic
        // ==========================================

        const initAuth = async () => {
            try {
                await signInAnonymously(auth);
            } catch (error) {
                console.error("Auth Error:", error);
                showToast("인증 실패: " + error.message, "error");
                setState(s => s.loading = false);
            }
        };

        const subscribeToProducts = () => {
            onAuthStateChanged(auth, (user) => {
                state.currentUser = user;

                if (!user) return;

                try {
                    const q = collection(db, COLLECTION_NAME);
                    
                    onSnapshot(q, (snapshot) => {
                        const items = [];
                        snapshot.forEach((doc) => items.push({ id: doc.id, ...doc.data() }));
                        items.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
                        
                        setState(s => {
                            s.products = items;
                            s.loading = false;
                            
                            if (s.selectedProductId) {
                                const updated = items.find(p => p.id === s.selectedProductId);
                                if (updated && (!s.isAdmin || s.viewData.id !== s.selectedProductId)) {
                                    s.viewData = JSON.parse(JSON.stringify(updated));
                                }
                            }
                        });
                    }, (error) => {
                        console.error("Firestore Listen Error:", error);
                        setState(s => s.loading = false);
                        if (error.code === 'permission-denied') {
                            showToast("⚠️ 권한 오류: Firebase Console > Rules 설정이 필요합니다.", "error");
                        } else {
                            showToast("DB 연결 실패: " + error.message, "error");
                        }
                    });
                } catch (err) {
                    console.error("Firestore Setup Error:", err);
                    showToast("시스템 오류 발생", "error");
                }
            });
        };

        setTimeout(() => {
            if (state.loading) {
                setState(s => s.loading = false);
                showToast("네트워크 응답이 없습니다.", "error");
            }
        }, 10000);

        // ==========================================
        // 4. Actions
        // ==========================================
        window.actions = {
            toggleAuthModal: (show) => setState(s => s.showAuthModal = show),
            toggleAdminMode: () => {
                if (state.isAdmin) setState(s => s.isAdmin = false);
                else setState(s => s.showAuthModal = true);
            },
            handleAdminLogin: () => {
                try {
                    if (checkPassword(state.passwordInput)) {
                        setState(s => { s.isAdmin = true; s.showAuthModal = false; s.passwordInput = ""; s.loginError = false; });
                        showToast("관리자 모드 로그인 완료");
                    } else {
                        setState(s => s.loginError = true);
                    }
                } catch (err) {
                    console.error("Login Error:", err);
                    showToast("로그인 오류", "error");
                }
            },
            updatePasswordInput: (val) => { 
                state.passwordInput = val; 
            }, 
            
            selectProduct: (id) => {
                const product = state.products.find(p => p.id === id);
                if(product) setState(s => { s.selectedProductId = id; s.viewData = JSON.parse(JSON.stringify(product)); s.activeTab = 'info'; s.isNewProduct = false; });
            },
            backToList: () => setState(s => { s.selectedProductId = null; s.viewData = null; s.isNewProduct = false; }),
            setTab: (tab) => setState(s => s.activeTab = tab),
            
            addProduct: () => {
                const newProduct = {
                    productName: "",
                    heroImage: "https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?auto=format&fit=crop&q=80&w=1000",
                    category: "신규",
                    operatingHours: "09:00 - 18:00",
                    description: "",
                    pricingOptions: [],
                    policies: { cancellation: "" },
                    faq: []
                };
                setState(s => { s.viewData = newProduct; s.selectedProductId = 'temp_new_id'; s.isNewProduct = true; s.activeTab = 'info'; });
            },

            saveProduct: async () => {
                if (!state.viewData || !state.currentUser) {
                    showToast("로그인이 필요하거나 데이터가 없습니다.", "error");
                    return;
                }
                try {
                    const colRef = collection(db, COLLECTION_NAME);
                    if (state.isNewProduct) {
                        await addDoc(colRef, { ...state.viewData, createdAt: serverTimestamp(), updatedAt: serverTimestamp() });
                        showToast("새 상품이 DB에 등록되었습니다.");
                    } else {
                        await updateDoc(doc(db, COLLECTION_NAME, state.viewData.id), { ...state.viewData, updatedAt: serverTimestamp() });
                        showToast("상품 정보가 수정되었습니다.");
                    }
                    actions.backToList();
                } catch (err) {
                    console.error(err);
                    if(err.code === 'permission-denied') showToast("저장 실패: DB 쓰기 권한이 없습니다.", "error");
                    else showToast("저장 실패: " + err.message, "error");
                }
            },

            initiateDelete: (e, id) => { e.stopPropagation(); setState(s => s.deleteTargetId = id); },
            cancelDelete: () => setState(s => s.deleteTargetId = null),
            executeDelete: async () => {
                if (!state.deleteTargetId) return;
                try {
                    await deleteDoc(doc(db, COLLECTION_NAME, state.deleteTargetId));
                    setState(s => s.deleteTargetId = null);
                    showToast("상품이 DB에서 삭제되었습니다.");
                } catch (err) {
                    console.error(err);
                    if(err.code === 'permission-denied') showToast("삭제 실패: DB 쓰기 권한이 없습니다.", "error");
                    else showToast("삭제 실패: " + err.message, "error");
                }
            },

            initializeSampleData: async () => {
                if (!confirm("실제 DB에 샘플 데이터를 추가하시겠습니까?")) return;
                try {
                    const colRef = collection(db, COLLECTION_NAME);
                    for (const item of INITIAL_SAMPLE_DATA) await addDoc(colRef, { ...item, createdAt: serverTimestamp() });
                    showToast("DB에 샘플 데이터가 추가되었습니다.");
                } catch (err) {
                    console.error(err);
                    if(err.code === 'permission-denied') showToast("초기화 실패: DB 쓰기 권한이 없습니다.", "error");
                    else showToast("초기화 실패: " + err.message, "error");
                }
            },

            // [핵심] 입력 시 렌더링 방지
            updateViewData: (field, value) => {
                state.viewData[field] = value;
            },
            
            addOption: () => {
                const newOpt = { id: `opt${Date.now()}`, name: '', price: 0, unit: '1인', desc: '' };
                setState(s => { if (!s.viewData.pricingOptions) s.viewData.pricingOptions = []; s.viewData.pricingOptions.push(newOpt); });
            },
            removeOption: (idx) => setState(s => s.viewData.pricingOptions.splice(idx, 1)),
            
            updateOption: (idx, field, value) => {
                state.viewData.pricingOptions[idx][field] = value;
            },

            updatePolicy: (field, value) => {
                if (!state.viewData.policies) state.viewData.policies = {};
                state.viewData.policies[field] = value;
            },

            addFaq: () => {
                setState(s => {
                    if (!s.viewData.faq) s.viewData.faq = [];
                    s.viewData.faq.push({ q: '', a: '' });
                });
            },
            removeFaq: (idx) => setState(s => s.viewData.faq.splice(idx, 1)),
            
            updateFaq: (idx, field, value) => {
                state.viewData.faq[idx][field] = value;
            },
        };

        // ==========================================
        // 5. 렌더링
        // ==========================================
        function render() {
            const app = document.getElementById('app');

            let toastHtml = '';
            if (state.toast.show) {
                const bgColor = state.toast.type === 'error' ? 'bg-red-600' : 'bg-gray-800';
                const icon = state.toast.type === 'error' ? 'alert-triangle' : 'check-circle';
                toastHtml = `<div class="fixed top-20 left-1/2 transform -translate-x-1/2 z-[110] px-6 py-3 rounded-full shadow-lg text-white text-sm font-bold animate-fade-in flex items-center gap-2 ${bgColor}"><i data-lucide="${icon}" width="16"></i> ${state.toast.message}</div>`;
            }

            let deleteModalHtml = '';
            if (state.deleteTargetId) {
                deleteModalHtml = `<div class="fixed inset-0 bg-black/60 flex items-center justify-center z-[120] px-4 backdrop-blur-sm animate-fade-in"><div class="bg-white rounded-xl p-6 w-full max-w-xs shadow-2xl text-center"><div class="bg-red-100 p-3 rounded-full inline-block mb-3"><i data-lucide="trash-2" class="text-red-600" width="24"></i></div><h3 class="font-bold text-lg text-gray-800 mb-1">삭제하시겠습니까?</h3><p class="text-xs text-gray-500 mb-4">실제 데이터가 영구적으로 삭제됩니다.</p><div class="flex gap-2 mt-4"><button onclick="actions.cancelDelete()" class="flex-1 py-3 bg-gray-200 rounded-lg font-bold text-gray-600 text-sm">취소</button><button onclick="actions.executeDelete()" class="flex-1 py-3 bg-red-600 text-white rounded-lg font-bold text-sm">삭제</button></div></div></div>`;
            }

            let authModalHtml = '';
            if (state.showAuthModal) {
                authModalHtml = `
                    <div class="fixed inset-0 bg-black/60 flex items-center justify-center z-[100] px-4 backdrop-blur-sm animate-fade-in">
                        <div class="bg-white rounded-xl p-6 w-full max-w-xs shadow-2xl">
                            <div class="text-center mb-4">
                                <h3 class="font-bold text-lg">관리자 접근</h3>
                                <p class="text-xs text-gray-500">비밀번호를 입력하세요.</p>
                            </div>
                            <div onkeyup="if(event.key === 'Enter') actions.handleAdminLogin()">
                                <input type="password" value="${state.passwordInput}" 
                                    oninput="actions.updatePasswordInput(this.value)" 
                                    class="w-full p-3 border border-gray-300 rounded-lg mb-3 text-center outline-none focus:border-emerald-500 transition-colors" 
                                    placeholder="Password" autofocus />
                                ${state.loginError ? '<p class="text-red-500 text-xs text-center mb-3 font-bold">비밀번호가 올바르지 않습니다.</p>' : ''}
                                <div class="flex gap-2">
                                    <button onclick="actions.toggleAuthModal(false)" class="flex-1 py-3 bg-gray-200 rounded-lg font-bold text-sm hover:bg-gray-300 transition-colors">취소</button>
                                    <button onclick="actions.handleAdminLogin()" class="flex-1 py-3 bg-emerald-600 text-white rounded-lg font-bold text-sm hover:bg-emerald-700 transition-colors">확인</button>
                                </div>
                            </div>
                        </div>
                    </div>`;
            }

            const navbarHtml = `
                <nav class="bg-white shadow-sm sticky top-0 z-50">
                    <div class="max-w-3xl mx-auto px-4 h-14 flex items-center justify-between">
                        <div class="flex items-center gap-2 cursor-pointer" onclick="actions.backToList()">
                            ${state.selectedProductId ? '<i data-lucide="chevron-left" class="text-gray-600" width="20"></i>' : ''}
                            <img src="${LOGO_IMAGE_URL}" alt="Logo" class="h-8 max-h-full object-contain" />
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="bg-emerald-100 text-emerald-700 text-[10px] font-bold px-2 py-1 rounded-full flex items-center gap-1"><i data-lucide="database" width="10"></i> 관리자 어드민</div>
                            <button onclick="actions.toggleAdminMode()" class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${state.isAdmin ? 'bg-emerald-600' : 'bg-gray-300'}">
                                <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${state.isAdmin ? 'translate-x-6' : 'translate-x-1'}"></span>
                            </button>
                        </div>
                    </div>
                </nav>`;

            let contentHtml = '';
            if (state.loading) {
                contentHtml = `<div class="min-h-[80vh] flex flex-col items-center justify-center text-gray-400 gap-3"><i data-lucide="loader-2" class="animate-spin-custom text-emerald-600" width="32"></i><span class="text-sm">데이터 불러오는 중...</span></div>`;
            } else if (!state.selectedProductId) {
                let productItems = state.products.length === 0 ? 
                    `<div class="py-20 text-center text-gray-400 border-2 border-dashed border-gray-200 rounded-xl col-span-full">
                        등록된 상품이 없습니다.
                        ${state.isAdmin ? '<br><button onclick="actions.initializeSampleData()" class="text-emerald-600 font-bold mt-2 hover:underline">DB에 샘플 데이터 추가</button>' : ''}
                    </div>` :
                    state.products.map(p => `
                        <div onclick="actions.selectProduct('${p.id}')" class="group bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-md transition-all cursor-pointer relative">
                            <div class="relative h-40 bg-gray-200 overflow-hidden">
                                <img src="${p.heroImage}" alt="${p.productName}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" onerror="this.src='https://via.placeholder.com/400x300'"/>
                                <div class="absolute top-2 left-2 bg-black/50 backdrop-blur-md text-white text-[10px] font-bold px-2 py-1 rounded">${p.category || '기본'}</div>
                                ${state.isAdmin ? `<button onclick="actions.initiateDelete(event, '${p.id}')" class="absolute top-2 right-2 bg-white/90 p-1.5 rounded-full text-red-500 hover:bg-red-50 hover:text-red-600 shadow-sm z-10"><i data-lucide="trash-2" width="14"></i></button>` : ''}
                            </div>
                            <div class="p-4">
                                <h3 class="font-bold text-gray-800 line-clamp-1 mb-1">${p.productName}</h3>
                                <div class="flex justify-between items-center mt-2 pt-2 border-t border-gray-100">
                                    <span class="text-xs text-gray-400">옵션 ${p.pricingOptions?.length || 0}개</span>
                                    <div class="text-emerald-600 font-bold text-sm">안내 보기 →</div>
                                </div>
                            </div>
                        </div>`).join('');

                contentHtml = `
                    <div class="p-4 animate-fade-in">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="font-bold text-xl text-gray-800 flex items-center gap-2">${state.isAdmin ? '상품 관리 (DB)' : '추천 추가 상품'}</h2>
                            ${state.isAdmin ? `<button onclick="actions.addProduct()" class="bg-emerald-600 text-white text-xs font-bold px-3 py-2 rounded-lg flex items-center gap-1 hover:bg-emerald-700 shadow-sm"><i data-lucide="plus" width="14"></i> 상품 추가</button>` : ''}
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">${productItems}</div>
                    </div>`;
            } else if (state.viewData) {
                const vd = state.viewData;
                if (!state.isAdmin) {
                    const priceOptions = (vd.pricingOptions || []).map(opt => `<div class="p-4 flex justify-between items-center hover:bg-gray-50 transition-colors"><div class="pr-4"><div class="font-bold text-gray-800 text-base">${opt.name}</div>${opt.desc ? `<div class="text-xs text-gray-500 mt-1">${opt.desc}</div>` : ''}</div><div class="text-right shrink-0"><div class="font-bold text-emerald-600 text-lg">${formatCurrency(opt.price)}원</div><div class="text-xs text-gray-400 font-medium">${opt.unit}</div></div></div>`).join('');
                    
                    let tabContent = state.activeTab === 'info' ? 
                        `<p class="text-gray-600 text-sm whitespace-pre-line leading-relaxed">${vd.description}</p>` : 
                        (state.activeTab === 'policy' ? 
                            `<div class="space-y-4"><div class="bg-amber-50 border border-amber-100 p-4 rounded-lg text-sm"><p class="whitespace-pre-line">${vd.policies?.cancellation || '-'}</p></div></div>` : 
                            (vd.faq || []).map(f => `<div class="bg-gray-50 p-4 rounded-lg text-sm border border-gray-100 mb-3"><div class="font-bold text-emerald-800 mb-2">Q. ${f.q}</div><div class="text-gray-600 pl-4">A. ${f.a}</div></div>`).join(''));

                    contentHtml = `
                        <div class="animate-fade-in">
                            <div class="relative h-64 md:h-80 bg-gray-200">
                                <img src="${vd.heroImage}" alt="Product" class="w-full h-full object-cover" />
                                <button onclick="actions.backToList()" class="absolute top-4 left-4 bg-white/30 backdrop-blur-md p-2 rounded-full text-white hover:bg-white/50 transition"><i data-lucide="chevron-left" width="24"></i></button>
                                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-5 pt-20 text-white">
                                    <h2 class="text-2xl md:text-3xl font-bold leading-tight mb-1">${vd.productName}</h2>
                                </div>
                            </div>
                            <div class="m-5"><h3 class="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2"><i data-lucide="menu" class="text-emerald-600" width="18"></i> 상품 요금표</h3><div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"><div class="divide-y divide-gray-100">${priceOptions}</div></div></div>
                            <div class="bg-white mt-2 border-t border-gray-200 pb-10">
                                <div class="flex border-b border-gray-200 sticky top-14 bg-white z-40">
                                    <button onclick="actions.setTab('info')" class="flex-1 py-3 text-sm font-medium border-b-2 ${state.activeTab === 'info' ? 'border-emerald-600 text-emerald-600' : 'border-transparent text-gray-500'}">상세 정보</button>
                                    <button onclick="actions.setTab('policy')" class="flex-1 py-3 text-sm font-medium border-b-2 ${state.activeTab === 'policy' ? 'border-emerald-600 text-emerald-600' : 'border-transparent text-gray-500'}">기타사항</button>
                                    <button onclick="actions.setTab('faq')" class="flex-1 py-3 text-sm font-medium border-b-2 ${state.activeTab === 'faq' ? 'border-emerald-600 text-emerald-600' : 'border-transparent text-gray-500'}">FAQ</button>
                                </div>
                                <div class="p-5 min-h-[300px]">${tabContent}</div>
                            </div>
                        </div>`;
                } else {
                    // [수정] 템플릿 리터럴의 백틱(`)이 명확하게 포함되도록 수정함
                    const optionsEdit = (vd.pricingOptions || []).map((opt, idx) => `
                        <div class="bg-gray-50 p-3 rounded border border-gray-200 relative mb-2">
                            <button onclick="actions.removeOption(${idx})" class="absolute top-2 right-2 text-gray-400 hover:text-red-500"><i data-lucide="trash-2" width="14"></i></button>
                            <div class="grid grid-cols-2 gap-2 mb-2 pr-6">
                                <input placeholder="옵션명" class="p-1 border rounded text-sm" value="${opt.name}" oninput="actions.updateOption(${idx}, 'name', this.value)">
                                <input placeholder="가격" type="number" class="p-1 border rounded text-sm text-right" value="${opt.price}" oninput="actions.updateOption(${idx}, 'price', this.value)">
                            </div>
                            <div class="flex gap-2">
                                <input placeholder="단위" class="w-1/4 p-1 border rounded text-xs text-center" value="${opt.unit}" oninput="actions.updateOption(${idx}, 'unit', this.value)">
                                <input placeholder="설명" class="w-3/4 p-1 border rounded text-xs" value="${opt.desc}" oninput="actions.updateOption(${idx}, 'desc', this.value)">
                            </div>
                        </div>
                    `).join('');
                    
                    const faqEdit = (vd.faq || []).map((f, idx) => `
                        <div class="bg-gray-50 p-3 rounded border border-gray-200 relative mb-2">
                            <button onclick="actions.removeFaq(${idx})" class="absolute top-2 right-2 text-gray-400 hover:text-red-500"><i data-lucide="trash-2" width="14"></i></button>
                            <div class="mb-2 pr-6">
                                <label class="block text-[10px] font-bold text-gray-400 mb-1">질문 (Q)</label>
                                <input class="w-full p-1 border rounded text-sm" value="${f.q}" oninput="actions.updateFaq(${idx}, 'q', this.value)">
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-gray-400 mb-1">답변 (A)</label>
                                <textarea class="w-full p-1 border rounded text-sm" rows="2" oninput="actions.updateFaq(${idx}, 'a', this.value)">${f.a}</textarea>
                            </div>
                        </div>
                    `).join('');

                    contentHtml = `
                        <div class="bg-white min-h-screen p-6 animate-fade-in">
                            <div class="mb-6 pb-4 border-b border-gray-200 flex justify-between items-center sticky top-14 bg-white z-40 pt-2">
                                <h2 class="text-xl font-bold flex items-center gap-2 text-gray-800"><i data-lucide="settings" class="text-emerald-600"></i> 상품 수정</h2>
                                <div class="flex gap-2"><button onclick="actions.backToList()" class="px-3 py-2 bg-gray-200 rounded text-xs font-bold text-gray-600">취소</button><button onclick="actions.saveProduct()" class="px-4 py-2 bg-emerald-600 text-white rounded text-xs font-bold hover:bg-emerald-700">저장</button></div>
                            </div>
                            <form class="space-y-6" onsubmit="event.preventDefault()">
                                <section class="space-y-3">
                                    <label class="block text-xs font-bold text-gray-500">상품명</label>
                                    <input type="text" value="${vd.productName}" oninput="actions.updateViewData('productName', this.value)" class="w-full p-2 border border-gray-300 rounded font-bold text-sm" />
                                    
                                    <label class="block text-xs font-bold text-gray-500">카테고리</label>
                                    <input type="text" value="${vd.category || ''}" oninput="actions.updateViewData('category', this.value)" class="w-full p-2 border border-gray-300 rounded text-sm" placeholder="예: 우리만 (Private)" />
                                    
                                    <label class="block text-xs font-bold text-gray-500">이미지 URL</label>
                                    <input type="text" value="${vd.heroImage}" oninput="actions.updateViewData('heroImage', this.value)" class="w-full p-2 border border-gray-300 rounded text-xs font-mono text-gray-500" />
                                    
                                    <label class="block text-xs font-bold text-gray-500">설명</label>
                                    <textarea rows="4" oninput="actions.updateViewData('description', this.value)" class="w-full p-2 border border-gray-300 rounded text-sm">${vd.description}</textarea>
                                </section>

                                <section class="space-y-3 border-t pt-4">
                                    <h3 class="font-bold text-sm text-gray-800">기타사항</h3>
                                    <div>
                                        <textarea rows="3" oninput="actions.updatePolicy('cancellation', this.value)" class="w-full p-2 border border-gray-300 rounded text-sm" placeholder="기타 안내 사항을 입력하세요">${vd.policies?.cancellation || ''}</textarea>
                                    </div>
                                </section>

                                <section class="space-y-3 border-t pt-4">
                                    <div class="flex justify-between items-center"><h3 class="font-bold text-sm text-gray-800">요금 옵션</h3><button onclick="actions.addOption()" class="text-xs bg-emerald-100 text-emerald-700 px-2 py-1 rounded font-bold flex items-center gap-1"><i data-lucide="plus" width="12"></i> 추가</button></div>
                                    <div>${optionsEdit}</div>
                                </section>

                                <section class="space-y-3 border-t pt-4">
                                    <div class="flex justify-between items-center"><h3 class="font-bold text-sm text-gray-800">FAQ (자주 묻는 질문)</h3><button onclick="actions.addFaq()" class="text-xs bg-emerald-100 text-emerald-700 px-2 py-1 rounded font-bold flex items-center gap-1"><i data-lucide="plus" width="12"></i> 추가</button></div>
                                    <div>${faqEdit}</div>
                                </section>

                                <div class="h-12"></div>
                            </form>
                        </div>`;
                }
            }

            app.innerHTML = `${toastHtml}${deleteModalHtml}${authModalHtml}${navbarHtml}<div class="max-w-3xl mx-auto pb-12">${contentHtml}</div>`;
            lucide.createIcons();
        }

        initAuth();
        subscribeToProducts();
        render();
    </script>
</body>

</html>
